---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(ggplot2)
library(gggenes)
library(ggh4x)

DcoA_size = 81972245
DcoB_size = 87717704
DpaA_size = 85103150
DpaB_size = 88703182

depth_graph_height = 2.5

readdepth_linewidth = 0.5
genome_readdepth_average_linewidth = 0.2
dashed_line_color = "royalblue4"

all_arrowhead_height = 3
all_arrowhead_width = 1

ten_thousandths<-function(x){
  x/10000
}


input_filename <- "Dco_scaffold_end_read_depth_data.txt"
readdepth_df <- read_tsv(input_filename)

Dco_readdepth_graph <- ggplot(readdepth_df) +
  geom_line(mapping = aes(x = coordinate, y = read_depth), linewidth = readdepth_linewidth) +
  theme_bw() +
  facet_grid( . ~ end_name, scales = "free") +
  geom_ribbon(data=readdepth_df, aes(x = coordinate, y = read_depth, ymin=0, ymax=read_depth), fill="grey80", alpha=0.5) +
  #scale_x_continuous(labels = scales::comma) +
  #theme(axis.title.x=element_blank(),
  #      axis.text.x=element_blank(),
  #      axis.ticks.x=element_blank()) +
  geom_hline(yintercept=93,linetype=2, linewidth = genome_readdepth_average_linewidth, color = dashed_line_color) +
  coord_cartesian(ylim = c(0, 1000)) +
  theme(axis.text = element_text(size = 8))

# DcoA_left: 30 kb
# DcoA_right: 30 kb
# DcoB_left: 30 kb
# DcoB_right: 30 kb

Dco_end <- 30000

position_scales <- list(
  scale_x_continuous(limits = c(0, Dco_end)),
  scale_x_continuous(limits = c(DcoA_size-Dco_end, DcoA_size)),
  scale_x_continuous(limits = c(0, Dco_end)),
  scale_x_continuous(limits = c(DcoB_size-Dco_end, DcoB_size))
)

Dco_readdepth_graph <- Dco_readdepth_graph + facetted_pos_scales(x = position_scales)

# Setting the sizes of panels individually
# because all x scales are 30k, we set it to '3' arbitrarily
Dco_readdepth_graph <- Dco_readdepth_graph + force_panelsizes(rows = depth_graph_height,
                                                              cols = 7,
                                                              respect = TRUE)

Dco_readdepth_graph





```



```{r}
structures_df <- read_tsv("Dco_subtelomere_features.txt", col_types=c("c", "c", "i", "i"))

Dco_structures_plot <- ggplot(structures_df, aes(xmin = start, xmax = end, y = "genome", fill = gene, label = gene, linewidth = 0)) +
                        facet_grid( . ~ molecule, scales = "free") +
                        geom_gene_arrow(arrowhead_height = unit(all_arrowhead_height, "mm"),
                                        arrowhead_width = unit(all_arrowhead_width, "mm"),
                                        show.legend = FALSE) +
                        theme_genes() +
                        #theme(axis.text.x = element_text(angle = -45, hjust=0, vjust=0.5, size = 8)) +
                        scale_fill_manual(values=c("#91bfdb", "#fc8d59"))

position_scales <- list(
  scale_x_continuous(labels=ten_thousandths, limits = c(0, Dco_end)),
  scale_x_continuous(labels=ten_thousandths, limits = c(DcoA_size-Dco_end, DcoA_size)),
  scale_x_continuous(labels=ten_thousandths, limits = c(0, Dco_end)),
  scale_x_continuous(labels=ten_thousandths, limits = c(DcoB_size-Dco_end, DcoB_size))
)


Dco_structures_plot <- Dco_structures_plot + facetted_pos_scales(x = position_scales)

Dco_structures_plot <- Dco_structures_plot + force_panelsizes(rows = depth_graph_height,
                                                              cols = 7,
                                                              respect = TRUE)

Dco_structures_plot
```


```{r}




input_filename <- "Dpa_scaffold_end_read_depth_data.txt"
readdepth_df <- read_tsv(input_filename)

# read depth averages
# on the left end, DpaA and DpaB are homozygous and the read depth is roughly double (187)
# on the right ends, DpaA and DpaB are heterozygous and thus the read depth is ~94
genome_readdepth_averages <- data.frame(end_name = c("DpaA_left", "DpaA_right", "DpaB_left", "DpaB_right"), value = c(187, 94, 187, 94))


Dpa_readdepth_graph <- ggplot(readdepth_df) +
  geom_line(mapping = aes(x = coordinate, y = read_depth), linewidth = readdepth_linewidth) +
  theme_bw() +
  facet_grid( . ~ end_name, scales = "free") +
  geom_ribbon(data=readdepth_df, aes(x = coordinate, y = read_depth, ymin=0, ymax=read_depth), fill="grey80", alpha=0.5) +
  #scale_x_continuous(labels = scales::comma) +
  #theme(axis.title.x=element_blank(),
  #      axis.text.x=element_blank(),
  #      axis.ticks.x=element_blank()) +
  geom_hline(aes(yintercept = value),
             genome_readdepth_averages,
             linetype=2,
             linewidth = genome_readdepth_average_linewidth,
             color = dashed_line_color) +
  coord_cartesian(ylim = c(0, 2000)) +
  theme(axis.text = element_text(size = 8))

# DpaA_left: 45 kb
# DpaA_right: 75 kb
# DpaB_left (same as DpaA_left): 45 kb
# DcoB_right: 60 kb

DpaA_left <- 45000
DpaA_right <- 75000
DpaB_left <- 45000
DpaB_right <- 60000

position_scales <- list(
  scale_x_continuous(limits = c(0, DpaA_left), breaks = seq(0, 90000000, 20000)),
  scale_x_continuous(limits = c(DpaA_size-DpaA_right, DpaA_size), breaks = seq(0, 90000000, 20000)),
  scale_x_continuous(limits = c(0, DpaB_left), breaks = seq(0, 90000000, 20000)),
  scale_x_continuous(limits = c(DpaB_size-DpaB_right, DpaB_size), breaks = seq(0, 90000000, 20000))
)


Dpa_readdepth_graph <- Dpa_readdepth_graph + facetted_pos_scales(x = position_scales)

# Setting the sizes of panels individually
# because all x scales are 30k, we set it to '3' arbitrarily
Dpa_readdepth_graph <- Dpa_readdepth_graph +
                        force_panelsizes(rows = depth_graph_height-0.5,
                                         cols = c(DpaA_left/10000, DpaA_right/10000, DpaB_left/10000, DpaB_right/10000),
                                         respect = TRUE)

Dpa_readdepth_graph
```


```{r}
structures_df <- read_tsv("Dpa_subtelomere_features.txt", col_types=c("c", "c", "i", "i"))

Dpa_structures_plot <- ggplot(structures_df, aes(xmin = start, xmax = end, y = "genome", fill = gene, label = gene, linewidth = 0)) +
                        facet_grid( . ~ molecule, scales = "free") +
                        geom_gene_arrow(arrowhead_height = unit(all_arrowhead_height, "mm"),
                                        arrowhead_width = unit(all_arrowhead_width, "mm"),
                                        show.legend = FALSE) +
                        theme_genes() +
                        #theme(axis.text.x = element_text(angle = -45, hjust=0, vjust=0.5, size = 8)) +
                        scale_fill_manual(values=c("#91bfdb", "#fc8d59"))

position_scales <- list(
  scale_x_continuous(labels=ten_thousandths, limits = c(0, DpaA_left), breaks = seq(0, 90000000, 20000)),
  scale_x_continuous(labels=ten_thousandths, limits = c(DpaA_size-DpaA_right, DpaA_size), breaks = seq(0, 90000000, 20000)),
  scale_x_continuous(labels=ten_thousandths, limits = c(0, DpaB_left), breaks = seq(0, 90000000, 20000)),
  scale_x_continuous(labels=ten_thousandths, limits = c(DpaB_size-DpaB_right, DpaB_size), breaks = seq(0, 90000000, 20000))
)

Dpa_structures_plot <- Dpa_structures_plot + facetted_pos_scales(x = position_scales)

Dpa_structures_plot <- Dpa_structures_plot + force_panelsizes(rows = depth_graph_height,
                                                              cols = c(DpaA_left/10000, DpaA_right/10000, DpaB_left/10000, DpaB_right/10000),
                                                              respect = TRUE)

Dpa_structures_plot
```


```{r}


Dco_combined_repeats_and_read_depth <- Dco_readdepth_graph +
                                    Dco_structures_plot +
                                    plot_layout(ncol = 1, nrow = )
                                    
Dco_combined_repeats_and_read_depth


```

```{r}
ggsave("Dco_chrom_end_depth_and_subtel_repeats_skinny_short.pdf", Dco_combined_repeats_and_read_depth, width = 15.1, height = 7, units = "cm")
```



```{r}
Dpa_combined_repeats_and_read_depth <- Dpa_readdepth_graph +
                                    Dpa_structures_plot +
                                    plot_layout(ncol = 1, nrow = )
                                    
Dpa_combined_repeats_and_read_depth
```


```{r}
ggsave("Dpa_chrom_end_depth_and_subtel_repeats_wide_short.pdf", Dpa_combined_repeats_and_read_depth, width = 17, height = 7, units = "cm")
```



Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
