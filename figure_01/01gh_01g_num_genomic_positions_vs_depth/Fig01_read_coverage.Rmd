---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}

library(tidyverse)
library(ggplot2)
library(cowplot)
library(ggh4x)
library(scales)

top_bottom_margin <- 0.05

#turn a value from 1,000,000 to 1
millionth<-function(x){
  x/1000000
}
#inverse: multiple by 1,000,000
million_times<-function(x){
  x*1000000
}

line_width_value = 0.2
label_font_size = 8
DcoA_size = 81972245
DcoB_size = 87717704


input_filename = "Dco.aln.sorted.samtools_depth.window100000.txt"

df_scaf_1_and_2 <- read_tsv(input_filename)

Dco_read_depth_graph <- ggplot(df_scaf_1_and_2) +
  geom_line(mapping = aes(x = coordinate, y = read_depth), linewidth = line_width_value) +
  facet_grid( . ~ scaffold, scales = "free") +
  theme_bw() +
  theme(panel.spacing.x = unit(0,"line")) +
  theme(axis.text.x=element_text(size=label_font_size),
        axis.text.y=element_text(size=label_font_size),
        axis.title=element_text(size=label_font_size,face="bold"),
        strip.text=element_text(size = label_font_size)) +
  theme(strip.text = element_text(face = "bold", size = label_font_size, margin = margin(top_bottom_margin,0,top_bottom_margin,0, "cm"))) +
  scale_x_continuous(labels=millionth, expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0)) +
  coord_cartesian(ylim = c(0, 300))

position_scales <- list(
  scale_x_continuous(labels=millionth, limits = c(0, DcoA_size), expand = c(0, 0)),
  scale_x_continuous(labels=millionth, limits = c(0, DcoB_size), expand= c(0, 0))
)

Dco_read_depth_graph <- Dco_read_depth_graph + facetted_pos_scales(x = position_scales)

# Setting the sizes of panels individually
Dco_read_depth_graph <- Dco_read_depth_graph + force_panelsizes(rows = 2, cols = c(DcoA_size/10000000, DcoB_size/10000000), respect = TRUE)

Dco_read_depth_graph

```

```{r}
DpaA_size = 85103150
DpaB_size = 88703182

hom_size = 17839851

input_filename = "Dpa.aln.sorted.samtools-depth.window100000.txt"

df_scaf_1_and_2 <- read_tsv(input_filename)

Dpa_read_depth_graph <- ggplot(df_scaf_1_and_2) +
  geom_line(mapping = aes(x = coordinate, y = read_depth), linewidth = line_width_value) +
  facet_grid( . ~ scaffold, scales="free" ) +
  theme_bw() +
  theme(panel.spacing.x = unit(0,"line")) +
  theme(axis.text.x =element_text(size=label_font_size),
        axis.text.y = element_text(size=label_font_size),
        axis.title=element_text(size=label_font_size,face="bold"),
        strip.text = element_text(size = label_font_size)) +
  theme(strip.text = element_text(face = "bold", size = label_font_size, margin = margin(top_bottom_margin,0,top_bottom_margin,0, "cm"))) +
  scale_x_continuous(labels=millionth, expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0)) +
  coord_cartesian(ylim = c(0, 300))

position_scales <- list(
  scale_x_continuous(labels=millionth, limits = c(0, DpaA_size), expand = c(0, 0)),
  scale_x_continuous(labels=millionth, limits = c(hom_size + 1, DpaB_size), expand= c(0, 0))
)

Dpa_read_depth_graph <- Dpa_read_depth_graph + facetted_pos_scales(x = position_scales)

# Setting the sizes of panels individually
Dpa_read_depth_graph <- Dpa_read_depth_graph + force_panelsizes(rows = 2, cols = c(DpaA_size/10000000, (DpaB_size-hom_size)/10000000), respect = TRUE)

Dpa_read_depth_graph


```

```{r}
Diploscapter_read_depths <- plot_grid(Dco_read_depth_graph, Dpa_read_depth_graph, labels = c('', ''), label_size = 8,  ncol = 2)

Diploscapter_read_depths
```

```{r}
# save the plot

ggsave('Figure_01_read_coverage_by_position.pdf', Diploscapter_read_depths, width = 16.5, height = 4, units = 'cm')
```

```{r}
# graph the Dco depths
input_filename = "Dco.aln.sorted.samtools_depth.txt.tabulated.txt"

depth_df <- read_tsv(input_filename)

Dco_depth_graph <- ggplot(depth_df) +
  geom_point(mapping = aes(x = depth, y = num_of_positions), size = 0.01) +
  theme_bw() +
  theme(axis.text=element_text(size=8, family="Helvetica"), axis.title=element_text(size=6,face="bold")) +
  theme(strip.text = element_text(face = "bold", size = 8)) +
  coord_cartesian(xlim = c(0, 300), ylim = c(0, 8000000)) +
  geom_vline(xintercept=93, linewidth=0.1) +
  scale_y_continuous(labels = millionth) 
  #coord_cartesian(ylim = c(0, 7000000))
  #scale_x_continuous(labels = scales::comma, expand = c(0, 0)) +
  #scale_y_continuous(expand = c(0, 0)) +
  #coord_cartesian(ylim = c(0, 400))

Dco_depth_graph

```




```{r}
# graph the Dpa depths
input_filename = "Dpa.aln.sorted.samtools-depth.txt.tabulated.txt"

depth_df <- read_tsv(input_filename)

Dpa_depth_graph <- ggplot(depth_df) +
  geom_point(mapping = aes(x = depth, y = num_of_positions), size = 0.01) +
  theme_bw() +
  theme(axis.text=element_text(size=8, family="Helvetica"), axis.title=element_text(size=6,face="bold")) +
  theme(strip.text = element_text(face = "bold", size = 8)) +
  coord_cartesian(xlim = c(0, 300), ylim = c(0, 7000000)) +
  geom_vline(xintercept=94, linewidth=0.1) +
  geom_vline(xintercept=187, linewidth=0.1) +
  scale_y_continuous(labels = millionth)
  #coord_cartesian(ylim = c(0, 7000000))
  #scale_x_continuous(labels = scales::comma, expand = c(0, 0)) +
  #scale_y_continuous(expand = c(0, 0)) +
  #coord_cartesian(ylim = c(0, 400))

Dpa_depth_graph

```

```{r}
Diploscapter_depths_hist <- plot_grid(Dco_depth_graph, Dpa_depth_graph, labels = c('', ''), label_size = 8,  ncol = 2)
Diploscapter_depths_hist
```

```{r}
# save the plot
ggsave('Figure_01_read_depth_histogram.pdf', Diploscapter_depths_hist, width = 9, height = 4, units = 'cm')
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
